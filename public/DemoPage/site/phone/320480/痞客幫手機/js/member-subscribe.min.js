(function($){$(document).ready(function(){setTimeout(function(){var subButtons=document.querySelectorAll(".subscribe-btn.member"),toast=document.getElementById("header-prompt"),timeoutId;ga("create","UA-408650-33","auto",{name:"subScribeTracker"});Array.prototype.forEach.call(subButtons,function(button){button.addEventListener("click",function(){$.ajax({type:"POST",async:true,dataType:"json",url:"/api/blog/followstatus",success:function(res){var isSub=res.data&&res.data.action==="follow";updateAllButtons(isSub);toast&&showToast(isSub);if(button.parentNode.classList.contains("subscribe-bar")){recordEvent("fixed-author-Intro",res.data.action)}else{recordEvent("author-Intro",res.data.action)}},error:function(data){toast&&showToast("發生錯誤，請稍候再試！")}});function showToast(isSub){clearTimeout(timeoutId);var message=isSub?"關注成功～":"已取消關注！";toast.innerText=message;toast.classList.add("prompt-success");timeoutId=setTimeout(function(){toast.classList.remove("prompt-success")},2e3)}function updateAllButtons(isSub){Array.prototype.forEach.call(subButtons,function(btn){var buttonText=isSub?"已關注":"關注";btn.setAttribute("data-follow-state",buttonText);btn.classList.toggle("following",isSub)})}function recordEvent(category,label){var _piq=window._piq||[];ga("subScribeTracker.send","event",category,"Button_關注會員",label);_piq.push(["trackEvent",category,"Button_關注會員",label])}})})},0)})})(jQuery);
